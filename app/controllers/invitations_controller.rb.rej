***************
*** 1,14 ****
  class InvitationsController < ApplicationController
    def new
-   	if params[:from]
-   		@user = facebook_session.user
-   		@user.profile_fbml = 
-   		render_to_string(:partial=>"profile",
-   		  :locals=>{:from=>params[:from]})	  
    	end
    	@from_user_id = facebook_session.user.to_s
    end
    
    # START:create
    def create
      @sent_to_ids = params[:ids]
--- 1,23 ----
  class InvitationsController < ApplicationController
+   
    def new
+   	if should_update_profile?
+   	  update_profile
    	end
    	@from_user_id = facebook_session.user.to_s
    end
    
+   def should_update_profile?
+     params[:from]
+   end
+   
+   def update_profile
+   	@user = facebook_session.user
+   	@user.profile_fbml = 
+   	render_to_string(:partial=>"profile",
+   	  :locals=>{:from=>params[:from]})	  
+   end
+   
    # START:create
    def create
      @sent_to_ids = params[:ids]
